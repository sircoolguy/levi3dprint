<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Levi 3D Print</title>
  
  <!-- Favicon (Updated dynamically) -->
  <link id="faviconLink" rel="icon" type="image/png" href="data:image/png;base64,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">
  
  <style>
    /* General layout */
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      color: white;
      background: #0a3d62; 
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Header */
    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 30px;
      position: relative;
      z-index: 10;
    }

    .logo {
      width: 160px;
      margin-bottom: 10px;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      aspect-ratio: 1 / 1;
      overflow: hidden; 
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent; 
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }

    /* Tabs */
    nav {
      display: flex;
      gap: 10px;
      background: rgba(0, 0, 0, 0.2);
      padding: 10px 15px;
      border-radius: 10px;
    }

    #changeLogoButton {
      display: none; /* Hidden by default */
      margin-bottom: 15px;
      padding: 8px 15px;
      background: #ffc107;
      color: #333;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    #changeLogoButton:hover {
      background: #e0a800;
    }

    nav .tab {
      background: #0a3d62;
      border: none;
      color: white;
      font-size: 16px;
      padding: 8px 18px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    nav .tab:hover,
    nav .tab.active {
      background: #1e90ff;
    }

    /* Main content */
    main {
      text-align: center;
      margin-top: 50px;
      padding: 0 20px;
      position: relative;
      z-index: 10;
    }

    section {
      display: none;
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: 12px;
      max-width: 800px;
      margin: 0 auto;
    }

    section.active {
      display: block;
    }
    
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }
    
    p {
      font-size: 1.1em;
      line-height: 1.6;
    }

    /* Gallery */
    #gallery-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
      min-height: 150px;
    }
    
    #gallery-status {
      font-size: 1.2em;
      color: #ffb347;
      width: 100%;
    }

    .image-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 12px;
      overflow: hidden;
      background: #333;
      cursor: pointer; 
      transition: transform 0.3s ease;
    }

    .image-wrapper:hover {
      transform: scale(1.05);
    }

    .image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Label styling */
    .image-label {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 14px;
      padding: 5px;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .delete-btn {
      position: absolute;
      top: 6px;
      right: 6px;
      background: rgba(255, 0, 0, 0.8);
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      display: none; 
      z-index: 5;
      opacity: 0.9;
      transition: opacity 0.2s;
    }
    
    .delete-btn:hover {
      opacity: 1;
    }

    /* Upload area */
    .upload-area {
      margin: 20px 0;
      padding: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    
    .upload-inputs {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    
    /* Upload Progress Bar */
    #uploadProgressBarContainer {
        width: 100%;
        max-width: 300px;
        height: 10px;
        background: #333;
        border-radius: 5px;
        margin-top: 10px;
        overflow: hidden;
        display: none;
    }
    
    #uploadProgressBar {
        width: 0%;
        height: 100%;
        background: #1e90ff;
        transition: width 0.3s;
    }

    #imageLabelInput {
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ddd;
      width: 80%;
      max-width: 300px;
    }

    #imageUpload {
      display: none;
    }
    
    #upload-label {
      display: none;
      padding: 10px 15px;
      background: #1e90ff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    #upload-label:hover {
      background: #007bff;
    }
    
    #upload-status {
      display: inline-block;
      margin-left: 10px;
      font-size: 0.9em;
      min-height: 1.2em;
    }

    /* Footer */
    footer {
      text-align: center;
      position: relative;
      bottom: 5px;
      width: 100%;
      font-size: 13px;
      color: white;
      margin-top: 50px;
      padding-bottom: 10px;
      z-index: 10;
    }
    
    #userIdDisplay {
      font-size: 11px;
      color: rgba(255,255,255,0.5);
      margin-top: 5px;
    }

    /* Owner button - Tiny and Gray */
    #ownerButton {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #444; 
      color: #aaa;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 12px; /* Tiny font */
      cursor: pointer;
      z-index: 1000;
      transition: background 0.3s;
      opacity: 0.8;
    }
    
    #ownerButton:disabled {
      background: #222;
      cursor: not-allowed;
    }
    
    #ownerButton:not(:disabled):hover {
      background: #666;
      color: white;
      opacity: 1;
    }
    
    /* Home Contact Button */
    #generalQuoteBtn {
      margin-top: 20px;
      padding: 12px 25px;
      background: #1e90ff;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #generalQuoteBtn:hover {
      background: #007bff;
    }


    /* Wave background */
    .wave {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 120%;
      background: linear-gradient(135deg, #ff4500, #ff0000, #ff8c00, #ff6600, #ff4500);
      background-size: 400% 400%;
      clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
      z-index: -1;
      animation: waveMotion 6s ease-in-out infinite alternate,
        moveFade 15s ease-in-out infinite;
    }

    @keyframes waveMotion {
      0% { clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%); }
      50% { clip-path: polygon(0 0, 100% 0, 100% 92%, 0 98%); }
      100% { clip-path: polygon(0 0, 100% 0, 100% 95%, 0 90%); }
    }
    
    @keyframes moveFade {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Lightbox Styles */
    .lightbox {
      display: none;
      position: fixed;
      z-index: 3000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    
    .lightbox.active {
      display: flex;
    }

    .lightbox-content {
      max-width: 90%;
      max-height: 70vh;
      object-fit: contain;
      border: 2px solid #fff;
      border-radius: 5px;
      margin-bottom: 10px;
    }

    .lightbox-caption {
      color: white;
      margin-top: 5px;
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
    }

    .lightbox-actions {
        margin-top: 15px;
        text-align: center;
    }

    #orderButton {
        background: #28a745;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s;
        text-decoration: none; /* For mailto link style */
        display: inline-block;
    }
    
    #orderButton:hover {
        background: #218838;
    }

    /* Order Form Modal Styling */
    .order-form {
        display: flex;
        flex-direction: column;
        gap: 10px;
        text-align: left;
        width: 100%;
    }
    
    .order-form label {
        color: #ccc;
        font-size: 14px;
        margin-bottom: 2px;
    }
    
    .order-form input, .order-form textarea {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #555;
        background: #333;
        color: white;
        width: 100%;
        box-sizing: border-box;
    }
    
    .order-form textarea {
        resize: vertical;
        min-height: 80px;
    }

    .close-lightbox {
      position: absolute;
      top: 20px;
      right: 30px;
      color: #f1f1f1;
      font-size: 40px;
      font-weight: bold;
      transition: 0.3s;
      cursor: pointer;
      user-select: none;
    }

    .close-lightbox:hover {
      color: #ff4500;
    }

    .prev, .next {
      cursor: pointer;
      position: absolute;
      top: 50%;
      width: auto;
      padding: 16px;
      margin-top: -50px;
      color: white;
      font-weight: bold;
      font-size: 30px;
      transition: 0.3s ease;
      border-radius: 0 3px 3px 0;
      user-select: none;
    }

    .next {
      right: 0;
      border-radius: 3px 0 0 3px;
    }

    .prev {
      left: 0;
      border-radius: 0 3px 3px 0;
    }

    .prev:hover, .next:hover {
      background-color: rgba(255, 69, 0, 0.8);
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-content {
      background: #1e272e;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      text-align: center;
      width: 90%;
      max-width: 400px;
    }
    
    .modal-content h2 { margin-top: 0; color: #fff; }
    .modal-content p { color: #ccc; margin-bottom: 20px; }

    .modal-input {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid #555;
      background: #333;
      color: white;
      font-size: 16px;
    }
    
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .modal-buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }
    .modal-buttons button.confirm { background: #1e90ff; color: white; }
    .modal-buttons button.cancel { background: #555; color: white; }
    
  </style>
</head>
<body>
  <header>
    <div class="logo" title="Levi 3D Print">
      <img src="https://placehold.co/160x160/FFFFFF/0a3d62?text=L3D" alt="L3D Logo" id="mainLogoImage">
    </div>
    <nav>
      <button class="tab active" data-tab="home">Home</button>
      <button class="tab" data-tab="about">About</button>
      <button class="tab" data-tab="gallery">Gallery</button>
    </nav>
    <input type="file" id="logoUploadInput" accept="image/*" style="display: none;" />
    <button id="changeLogoButton">Change Logo</button>
  </header>

  <div class="wave"></div>

  <main>
    <section id="home" class="active">
      <h1>Welcome to Levi's custom 3d printing</h1>
      <p>Custom 3D printed creations designed with care and creativity.
      <br>The best part: I can customize almost everything!</p>
      <!-- NEW: Home Button -->
      <button id="generalQuoteBtn">Start a Custom Order</button>
    </section>

    <section id="about">
      <h1>About Us</h1>
      <p>At Levi 3D Print, we specialize in custom designs and innovative prints made for you.
      <br>I can make earrings, toys, models, cars, keychains.
      <br>Contact me on Facebook @ levi's custom 3d printing or email me at levitaba6@icloud.com</p>
    </section>

    <section id="gallery">
      <h1>Gallery</h1>
      <div class="upload-area" id="uploadArea">
        <div class="upload-inputs">
            <!-- Label Input -->
            <input type="text" id="imageLabelInput" placeholder="Enter item name (e.g. Red Dragon)" class="modal-input" />
            
            <!-- Multiple file input -->
            <label for="imageUpload" id="upload-label">Choose Files (Select multiple)</label>
            <input type="file" id="imageUpload" accept="image/*" multiple />
            
            <div id="uploadProgressBarContainer">
                <div id="uploadProgressBar"></div>
            </div>
            <span id="upload-status"></span>
        </div>
      </div>
      <div id="gallery-container">
        <p id="gallery-status">Loading gallery...</p>
      </div>
    </section>
  </main>

  <footer>
    <p>© 2025 Levi 3D Print. All rights reserved.</p>
    <div id="userIdDisplay">Connecting...</div>
  </footer>

  <button id="ownerButton" disabled>Loading...</button>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="lightbox">
    <span class="close-lightbox">&times;</span>
    <img class="lightbox-content" id="lightboxImg">
    <div id="lightboxCaption" class="lightbox-caption"></div>
    
    <!-- Order Button Area -->
    <div class="lightbox-actions">
        <button id="orderButton">Request Order / Quote</button>
    </div>

    <a class="prev" id="lightboxPrev">&#10094;</a>
    <a class="next" id="lightboxNext">&#10095;</a>
  </div>
  
  <!-- Custom Modal -->
  <div id="customModal" class="modal-overlay">
    <div class="modal-content">
      <h2 id="modalTitle">Modal Title</h2>
      <p id="modalMessage">This is the modal message.</p>
      
      <!-- Regular Input (Password) -->
      <input type="password" id="modalInput" class="modal-input" style="display: none;" />
      
      <!-- Order Form (Hidden by default) -->
      <div id="orderForm" class="order-form" style="display: none;">
          <label>Your Name:</label>
          <input type="text" id="orderName" placeholder="John Doe" />
          
          <label>Your Email (Optional):</label>
          <input type="email" id="orderEmail" placeholder="john@example.com" />
          
          <label>Notes / Customization:</label>
          <textarea id="orderNotes" placeholder="I would like this in blue..."></textarea>
      </div>

      <div class="modal-buttons">
        <button id="modalCancel" class="cancel">Cancel</button>
        <button id="modalConfirm" class="confirm">Draft Email</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { 
      getAuth, signInAnonymously, onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { 
      getFirestore, doc, addDoc, deleteDoc, onSnapshot, 
      collection, setLogLevel as setFirestoreLogLevel, updateDoc, setDoc
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ------------------------------------------------------------------
    // YOUR CONFIG
    // ------------------------------------------------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyAWYZGZ8nvgSAgpQ60OsLqathduMM2CbQE",
      authDomain: "levi3dprint-94bb0.firebaseapp.com",
      projectId: "levi3dprint-94bb0",
      storageBucket: "levi3dprint-94bb0.appspot.com",
      messagingSenderId: "1044564863427",
      appId: "1:1044564863427:web:37017271e5972aee7c3576",
      measurementId: "G-08JB2G438T"
    };
    // ------------------------------------------------------------------

    // ======= App Elements =======
    const tabs = document.querySelectorAll(".tab");
    const sections = document.querySelectorAll("section");
    const ownerButton = document.getElementById("ownerButton");
    const uploadArea = document.getElementById("uploadArea");
    const uploadInput = document.getElementById("imageUpload");
    const imageLabelInput = document.getElementById("imageLabelInput");
    const uploadLabel = document.getElementById("upload-label");
    const uploadStatus = document.getElementById("upload-status");
    const gallery = document.getElementById("gallery-container");
    const galleryStatus = document.getElementById("gallery-status");
    const userIdDisplay = document.getElementById("userIdDisplay");
    const progressBarContainer = document.getElementById("uploadProgressBarContainer");
    const progressBar = document.getElementById("uploadProgressBar");
    
    // Modal Elements
    const customModal = document.getElementById("customModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalMessage = document.getElementById("modalMessage");
    const modalInput = document.getElementById("modalInput");
    const modalCancel = document.getElementById("modalCancel");
    const modalConfirm = document.getElementById("modalConfirm");
    const orderForm = document.getElementById("orderForm"); 
    const orderName = document.getElementById("orderName"); 
    const orderEmail = document.getElementById("orderEmail"); 
    const orderNotes = document.getElementById("orderNotes"); 
    
    const changeLogoButton = document.getElementById("changeLogoButton");
    const logoUploadInput = document.getElementById("logoUploadInput");
    const mainLogoImage = document.getElementById("mainLogoImage");
    const faviconLink = document.getElementById("faviconLink");
    
    // Lightbox Elements
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightboxImg");
    const lightboxCaption = document.getElementById("lightboxCaption");
    const closeLightbox = document.querySelector(".close-lightbox");
    const lightboxPrev = document.getElementById("lightboxPrev");
    const lightboxNext = document.getElementById("lightboxNext");
    const orderButton = document.getElementById("orderButton"); 
    
    // NEW: General Quote Button
    const generalQuoteBtn = document.getElementById("generalQuoteBtn");

    // ======= App State =======
    let ownerMode = false;
    let currentUserId = null;
    let db, auth;
    let galleryCollectionRef = null;
    let modalConfirmCallback = null;
    
    // Tracks image objects: { id, images: [], label: "" }
    let galleryItems = new Map(); 
    
    // Lightbox Navigation State
    let currentLightboxImages = []; // Array of base64 strings for current item
    let currentLightboxIndex = 0;
    let currentItemLabel = ""; // Store label for email subject
    
    let logoDocRef = null;
    const placeholderLogoUrl = "https://placehold.co/160x160/FFFFFF/0a3d62?text=L3D";

    // ======= Tabs =======
    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        sections.forEach(s => s.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.dataset.tab).classList.add("active");
      });
    });
    
    // --- Helper to show errors on screen ---
    function showOnScreenError(title, message) {
        gallery.innerHTML = ''; // Clear gallery
        galleryStatus.textContent = `${title} ${message}`;
        galleryStatus.style.color = "#ff6b6b"; // Red color
    }

    // --- Modal Functions ---
    function showMessage(message, title = "Notice") {
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      modalMessage.style.display = "block";
      modalInput.style.display = "none";
      orderForm.style.display = "none"; // Hide order form
      modalCancel.style.display = "none";
      modalConfirm.textContent = "OK";
      customModal.style.display = "flex";
      
      modalConfirmCallback = () => {
        customModal.style.display = "none";
      };
    }

    function showConfirm(message, title, confirmText, callback) {
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      modalMessage.style.display = "block";
      modalInput.style.display = "none";
      orderForm.style.display = "none"; // Hide order form
      modalCancel.style.display = "inline-block";
      modalConfirm.textContent = confirmText;
      customModal.style.display = "flex";

      modalConfirmCallback = callback;
    }

    function showPrompt(message, title, callback) {
      modalTitle.textContent = title;
      modalMessage.textContent = message;
      modalMessage.style.display = "block";
      modalInput.value = "";
      modalInput.style.display = "block";
      orderForm.style.display = "none"; // Hide order form
      modalCancel.style.display = "inline-block";
      modalConfirm.textContent = "Submit";
      customModal.style.display = "flex";

      modalConfirmCallback = () => {
        callback(modalInput.value);
      };
    }

    // NEW: Show Order Form
    function showOrderForm(itemName, callback) {
        modalTitle.textContent = `Order Inquiry: ${itemName}`;
        modalMessage.style.display = "none"; // Hide standard message
        modalInput.style.display = "none";
        
        // Clear form
        orderName.value = "";
        orderEmail.value = "";
        orderNotes.value = "";
        
        orderForm.style.display = "flex"; // Show form
        
        modalCancel.style.display = "inline-block";
        modalConfirm.textContent = "Draft Email";
        customModal.style.display = "flex";
        
        modalConfirmCallback = () => {
            const details = {
                name: orderName.value,
                email: orderEmail.value,
                notes: orderNotes.value
            };
            callback(details);
        };
    }

    modalConfirm.addEventListener("click", () => {
      if (modalConfirmCallback) {
        modalConfirmCallback();
      }
      // Only auto-close if not a form (forms close themselves or need validation)
      if (orderForm.style.display === 'none' && modalInput.style.display === "none" && modalCancel.style.display === "none") {
         customModal.style.display = "none";
      }
    });

    modalCancel.addEventListener("click", () => {
      customModal.style.display = "none";
    });

    // ======= Owner system =======
    ownerButton.addEventListener("click", () => {
      if (!ownerMode) {
        showPrompt("Enter owner password:", "Owner Login", (password) => {
          if (password === "custom3dlevi") {
            ownerMode = true;
            showMessage("Owner mode activated!", "Success");
            uploadArea.style.display = "block";
            uploadLabel.style.display = "inline-block";
            changeLogoButton.style.display = "inline-block"; 
            updateDeleteButtons();
            customModal.style.display = "none";
          } else {
            showMessage("Incorrect password! Not signed in.", "Error");
            ownerMode = false;
            uploadArea.style.display = "none";
            uploadLabel.style.display = "none";
            changeLogoButton.style.display = "none";
            updateDeleteButtons();
          }
        });
      } else {
        ownerMode = false;
        showMessage("Signed out of Owner mode.", "Signed Out");
        uploadArea.style.display = "none";
        uploadLabel.style.display = "none";
        changeLogoButton.style.display = "none"; 
        updateDeleteButtons();
      }
    });

    // ======= Lightbox Logic =======
    function openLightbox(docId) {
        const item = galleryItems.get(docId);
        if (!item || !item.images || item.images.length === 0) return;
        
        currentLightboxImages = item.images;
        currentLightboxIndex = 0; // Start at first image
        currentItemLabel = item.label || "Item"; // Store for order button
        
        // Set caption
        lightboxCaption.textContent = currentItemLabel;
        
        updateLightboxContent();
        lightbox.classList.add("active");
    }
    
    function closeLightboxModal() {
        lightbox.classList.remove("active");
    }
    
    function updateLightboxContent() {
        if (currentLightboxImages.length > 0) {
            lightboxImg.src = currentLightboxImages[currentLightboxIndex];
        }
    }
    
    function nextImage() {
        if (currentLightboxImages.length <= 1) return;
        currentLightboxIndex = (currentLightboxIndex + 1) % currentLightboxImages.length;
        updateLightboxContent();
    }
    
    function prevImage() {
        if (currentLightboxImages.length <= 1) return;
        currentLightboxIndex = (currentLightboxIndex - 1 + currentLightboxImages.length) % currentLightboxImages.length;
        updateLightboxContent();
    }
    
    // Order Button Click (In Lightbox)
    orderButton.addEventListener("click", () => {
        showOrderForm(currentItemLabel, (details) => {
            if (!details.name) {
                alert("Please enter your name.");
                return; // Don't close
            }
            
            // Construct Mailto Link
            const subject = encodeURIComponent(`Order Inquiry: ${currentItemLabel}`);
            const body = encodeURIComponent(
`Hi Levi,

I am interested in ordering: ${currentItemLabel}

My Name: ${details.name}
My Email: ${details.email}

Notes:
${details.notes}

-----------------------------------
Sent from Levi 3D Print Website`
            );
            
            // Explicitly tell user what's happening
            alert("I have opened your default email app (like Mail or Outlook). Please check the draft and click Send!");
            
            window.location.href = `mailto:levis3dprint@gmail.com?subject=${subject}&body=${body}`;
            customModal.style.display = "none"; // Close modal
        });
    });

    // NEW: General Quote Button Click (In Home)
    generalQuoteBtn.addEventListener("click", () => {
        showOrderForm("Custom Request", (details) => {
             if (!details.name) {
                alert("Please enter your name.");
                return; // Don't close
            }
            
            const subject = encodeURIComponent(`Custom Order Inquiry`);
            const body = encodeURIComponent(
`Hi Levi,

I would like to request a custom quote.

My Name: ${details.name}
My Email: ${details.email}

My Request Details:
${details.notes}

-----------------------------------
Sent from Levi 3D Print Website`
            );
            
            alert("I have opened your default email app (like Mail or Outlook). Please check the draft and click Send!");
            
            window.location.href = `mailto:levis3dprint@gmail.com?subject=${subject}&body=${body}`;
            customModal.style.display = "none"; 
        });
    });

    
    closeLightbox.addEventListener("click", closeLightboxModal);
    lightboxNext.addEventListener("click", nextImage);
    lightboxPrev.addEventListener("click", prevImage);
    
    document.addEventListener("keydown", (e) => {
        if (!lightbox.classList.contains("active")) return;
        if (e.key === "Escape") closeLightboxModal();
        if (e.key === "ArrowRight") nextImage();
        if (e.key === "ArrowLeft") prevImage();
    });
    
    lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) closeLightboxModal();
    });


    // ======= Gallery UI Functions =======
    
    function addImageToPage(docId, imagesArray, labelText) {
      if (galleryItems.has(docId)) return; // Already on page

      // Store data for lightbox
      galleryItems.set(docId, { id: docId, images: imagesArray, label: labelText });

      if (galleryStatus) galleryStatus.style.display = "none";

      const wrapper = document.createElement("div");
      wrapper.classList.add("image-wrapper");
      wrapper.setAttribute('data-doc-id', docId);
      
      // Open lightbox on click
      wrapper.addEventListener("click", (e) => {
          if (e.target.classList.contains("delete-btn")) return;
          openLightbox(docId);
      });

      const img = document.createElement("img");
      // Use the first image as the thumbnail
      img.src = imagesArray[0];
      img.onerror = () => {
        img.src = `https://placehold.co/200x200/FF6600/FFFFFF?text=Error&font=poppins`;
      };
      
      const label = document.createElement("div");
      label.classList.add("image-label");
      label.textContent = labelText || "";

      const deleteBtn = document.createElement("button");
      deleteBtn.innerText = "×";
      deleteBtn.classList.add("delete-btn");
      deleteBtn.style.display = ownerMode ? "block" : "none";

      deleteBtn.addEventListener("click", (e) => {
        e.stopPropagation(); 
        showConfirm("Delete this item?", "Delete", "Delete", async () => {
          customModal.style.display = "none";
          try {
            const docRef = doc(db, "galleryImages", docId);
            await deleteDoc(docRef);
            showMessage("Deleted successfully!", "Success");
          } catch (error) {
            console.error("Error deleting: ", error);
            showMessage(`Error deleting: ${error.message}`, "Error");
          }
        });
      });

      wrapper.appendChild(img);
      wrapper.appendChild(label);
      wrapper.appendChild(deleteBtn);
      gallery.appendChild(wrapper);
    }
    
    function removeImageFromPage(docId) {
      const wrapper = document.querySelector(`.image-wrapper[data-doc-id="${docId}"]`);
      if (wrapper) wrapper.remove();
      galleryItems.delete(docId);
      
      if (galleryItems.size === 0) {
        if (galleryStatus) {
            galleryStatus.textContent = "No images in gallery yet. Upload one!";
            galleryStatus.style.display = "block";
            galleryStatus.style.color = "#ffb347";
        }
      }
    }

    // --- Helper to read multiple files ---
    function readFilesAsBase64(files) {
        return Promise.all(Array.from(files).map(file => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsDataURL(file);
            });
        }));
    }

    // --- Handle File Upload (Multiple Images) ---
    uploadInput.addEventListener("change", async () => {
      const files = uploadInput.files;
      if (!files || files.length === 0) return;

      if (!ownerMode) {
        showMessage("You must be in Owner mode to upload!", "Error");
        return;
      }
      
      // Check total size
      let totalSize = 0;
      for (let i = 0; i < files.length; i++) totalSize += files[i].size;
      
      // 1MB Limit
      if (totalSize > 1000000) { 
          showMessage("Total size is too large! All images combined must be under 1MB.", "Error");
          return;
      }
      
      // UI Loading State
      uploadStatus.textContent = "Processing images...";
      uploadLabel.style.display = "none";
      progressBarContainer.style.display = "block";
      progressBar.style.width = "20%";

      try {
          const imagesBase64 = await readFilesAsBase64(files);
          progressBar.style.width = "60%";
          
          const labelText = imageLabelInput.value; 

          // Save to Firestore
          await addDoc(galleryCollectionRef, {
            images: imagesBase64, // Array of strings
            label: labelText, 
            uploadedAt: new Date()
          });
          
          progressBar.style.width = "100%";
          uploadStatus.textContent = "Upload complete!";
          imageLabelInput.value = "";

      } catch (error) {
        console.error("Upload failed: ", error);
        showMessage(`Upload failed: ${error.message}`, "Error");
        uploadStatus.textContent = `Upload failed.`;
        progressBar.style.width = "0%";
      } finally {
        uploadInput.value = null; 
        setTimeout(() => {
            uploadLabel.style.display = "inline-block";
            progressBarContainer.style.display = "none";
            progressBar.style.width = "0%";
            uploadStatus.textContent = "";
        }, 2000);
      }
    });

    // --- Handle Logo Upload ---
    changeLogoButton.addEventListener("click", () => {
      logoUploadInput.click();
    });

    logoUploadInput.addEventListener("change", async () => {
      const file = logoUploadInput.files[0];
      if (!file || !ownerMode) return;
      
      if (file.size > 750000) {
          showMessage("Logo file is too large. Please use images under 750KB.", "Error");
          return;
      }

      showMessage("Uploading new logo...", "Updating");
      changeLogoButton.disabled = true;
      changeLogoButton.textContent = "Uploading...";
      
      const reader = new FileReader();
      reader.onload = async function(e) {
          const base64String = e.target.result;
          
          try {
            // Use setDoc with merge to avoid 'not defined' errors or missing docs
            await setDoc(logoDocRef, {
              imageUrl: base64String
            }, { merge: true });
            
            showMessage("Logo updated successfully!", "Success");
            
          } catch (error) {
            console.error("Logo upload failed:", error);
            showMessage(`Logo upload failed: ${error.message}`, "Error");
          } finally {
            logoUploadInput.value = null; 
            changeLogoButton.disabled = false;
            changeLogoButton.textContent = "Change Logo";
          }
      };
      reader.readAsDataURL(file);
    });

    // --- Update delete buttons visibility ---
    function updateDeleteButtons() {
      const buttons = document.querySelectorAll(".delete-btn");
      buttons.forEach(btn => {
        btn.style.display = ownerMode ? "block" : "none";
      });
    }

    // --- Firebase Initialization ---
    async function initializeFirebase() {
      try {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        galleryCollectionRef = collection(db, "galleryImages");
        logoDocRef = doc(db, "appData", "logo");

        onAuthStateChanged(auth, (user) => {
          if (user) {
            console.log("User is signed in:", user.uid);
            currentUserId = user.uid;
            userIdDisplay.textContent = `User ID: ${currentUserId.substring(0, 8)}...`;
            
            setupRealtimeListener();
            setupLogoListener(); 

            ownerButton.disabled = false;
            ownerButton.textContent = "Owner";

          } else {
            console.log("User is not signed in (state).");
            currentUserId = null;
            userIdDisplay.textContent = "Not signed in";
            
            ownerButton.disabled = true;
            ownerButton.textContent = "Loading...";
            
            ownerMode = false;
            uploadArea.style.display = "none";
            updateDeleteButtons();
          }
        });

        await signInAnonymously(auth);

      } catch (error) {
        console.error("Firebase Initialization Error:", error);
        
        if (error.code === 'auth/configuration-not-found') {
            showOnScreenError(
                "ACTION REQUIRED: Authentication not enabled.", 
                "Please go to your Firebase project > Build > Authentication > Sign-in method > and enable the 'Anonymous' provider."
            );
        } else {
            showOnScreenError("Error connecting to app.", error.message);
        }
        
        ownerButton.disabled = true;
        ownerButton.textContent = "Init Error";
      }
    }

    // --- Firestore Real-time Listener ---
    function setupRealtimeListener() {
      if (!galleryCollectionRef) return;

      onSnapshot(galleryCollectionRef, (snapshot) => {
        
        if (snapshot.empty) {
            gallery.innerHTML = ''; 
            galleryItems.clear();
            if (galleryStatus) {
                galleryStatus.textContent = "No images in gallery yet. Upload one!";
                galleryStatus.style.display = "block";
                galleryStatus.style.color = "#ffb347";
            }
            return;
        }

        if (galleryStatus) galleryStatus.style.display = "none";

        const currentDocIds = new Set();
        
        snapshot.docs.forEach(doc => {
          const docId = doc.id;
          currentDocIds.add(docId);
          const data = doc.data();
          
          // Handle both old (single image) and new (multi-image) formats
          let imagesArray = [];
          if (data.images && Array.isArray(data.images)) {
              imagesArray = data.images;
          } else if (data.imageUrl) {
              imagesArray = [data.imageUrl];
          }

          if (!galleryItems.has(docId)) {
            addImageToPage(docId, imagesArray, data.label);
          }
        });

        // Check for deletions
        galleryItems.forEach((item, docId) => {
          if (!currentDocIds.has(docId)) {
            removeImageFromPage(docId);
          }
        });

      }, (error) => {
        console.error("Firestore listener error:", error);
        showOnScreenError("Connection Error.", "Lost connection to the gallery. Please refresh the page.");
      });
    }

    function setupLogoListener() {
      if (!logoDocRef) return;
      
      onSnapshot(logoDocRef, (docSnap) => {
        if (docSnap.exists()) {
          const data = docSnap.data();
          if (data.imageUrl) {
              mainLogoImage.src = data.imageUrl;
              faviconLink.href = data.imageUrl; 
          }
        } else {
          mainLogoImage.src = placeholderLogoUrl;
          faviconLink.href = placeholderLogoUrl;
        }
      }, (error) => {
        console.error("Error loading logo:", error);
        // Handle permissions errors gracefully
        if (error.code !== 'permission-denied') {
             mainLogoImage.src = placeholderLogoUrl; 
             faviconLink.href = placeholderLogoUrl;
        }
      });
    }

    // --- START THE APP ---
    initializeFirebase();

  </script>
</body>
</html>